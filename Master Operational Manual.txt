This is your **Master Operational Manual**. It covers every step of the VHP (Vermont Health Platform) lifecycle, from generating an idea with AI to interacting with it in the Chat application.

**Prerequisite:** Open your terminal and navigate to your project root:

```bash
cd ~/Vermont-Health-Platform

```

---

### Phase 1: Content Generation (Gemini)

**Goal:** Create a structured JSON article using the latest protocol.

**1. The "Golden Key" Prompt**
You must copy this **entire block** into Gemini for every new article.

* **File Location:** `frontend/sanity/prompt_template_v7.txt` (Save this locally for safekeeping).

```text
*** SYSTEM INSTRUCTIONS: HTR CONTENT PROTOCOL v7.0 ***

ROLE: Chief Research Officer (HTR).
TASK: Generate a valid JSON payload for the "policyAnalysis" schema.

*** 1. STRICT OUTPUT RULES ***
- Output ONLY a single, raw JSON object. No markdown formatting (no ```json).
- No conversational text.
- Do NOT escape quotes inside the Data Table. Provide it as a standard JSON Array.
- VIDEO RULE: The "url" field MUST be a raw string (e.g., "[https://youtube.com/](https://youtube.com/)..."). Do NOT format it as a Markdown link.

*** 2. CATEGORY ENFORCEMENT (Must match Navbar) ***
Use ONLY these slugs for the 'category' field based on the chosen Pillar:

A. IF PILLAR = "Policy"
   - "regulation"  (Regulation & Legislation)
   - "mandates"    (Public Health Mandates)
   - "global"      (Global & Comparative Policy)
   - "feasibility" (Policy Feasibility Studies)

B. IF PILLAR = "Economics"
   - "value"       (Value-Based Care Models)
   - "market"      (Market & Finance)
   - "cea"         (Labor & Workforce Strategy)
   - "investment"  (Healthcare Investment Trends)

C. IF PILLAR = "Technology"
   - "ai"          (AI & Machine Learning)
   - "digital"     (Digital Health & Telemedicine)
   - "security"    (Data Security & Governance)
   - "workflow"    (Tech-Enabled Workflow)

*** 3. SCHEMA DEFINITION ***
{
  "_type": "policyAnalysis",
  "title": "String",
  "slug": { "current": "kebab-case-slug" },
  "publishedAt": "YYYY-MM-DDTHH:mm:ssZ",
  "status": "Active",
  "pillar": "Policy" | "Economics" | "Technology",
  "category": "String (See List Above)",
  "impactLevel": "Critical" | "High" | "Medium",
  "summary": "2-3 sentence abstract.",
  "body": [
    {
      "_type": "block",
      "style": "normal",
      "children": [{ "_type": "span", "text": "Paragraph text." }]
    },
    {
      "_type": "block",
      "style": "h2",
      "children": [{ "_type": "span", "text": "Header Text" }]
    },
    {
      "_type": "block",
      "style": "blockquote",
      "children": [{ 
         "_type": "span", 
         "text": "The quote text.", 
         "marks": ["highlight-economics"] 
      }]
    },
    {
      "_type": "code",
      "title": "Table Caption",
      "language": "json",
      "code": [
        { "Metric": "Value A", "Result": "Value B" },
        { "Metric": "Value C", "Result": "Value D" }
      ]
    },
    {
      "_type": "video",
      "url": "INSERT_REAL_URL_HERE",
      "caption": "Video description"
    },
    {
      "_type": "audio",
      "title": "Episode Title",
      "summary": "Short description of the audio clip."
    }
  ]
}

*** TASK PARAMETERS (EDIT THIS PART ONLY) ***
TARGET LENGTH: [e.g. 2000 Words]
INSTRUCTION: Expand on every section to meet this depth. Do not summarize; analyze.

TOPIC: [Insert Topic Here]
PILLAR: [Insert Pillar Here]
CATEGORY: [Insert Category Slug Here]
KEY DATA: [Insert Data Points]

```

**2. Saving the Output**

* Copy the JSON output from Gemini.
* Create a new file in: `frontend/sanity/content/`.
* **Naming Convention:** `articleX.json` (e.g., `article10.json`).
* **Action:** Paste the JSON and save.

---

### Phase 2: Importing to CMS (Sanity)

**Goal:** Upload the JSON file to the Sanity database.

**1. The Command**
Open your terminal (ensure you are in `Vermont-Health-Platform` root):

```bash
# 1. Enter Frontend
cd frontend

# 2. Run Import (Replace 'article10.json' with your actual filename)
node scripts/import.js article10.json

```

**2. Success Indicator**
You should see:

> `âœ… Imported: "Your Article Title"`

**Troubleshooting:**

* *Error: "Insufficient permissions"* -> Your token in `.env.local` is Viewer, not Editor.
* *Error: "File not found"* -> You typed the wrong filename or didn't save it in `sanity/content/`.

---

### Phase 3: Editing & Publishing (Sanity Studio)

**Goal:** Finalize the content and make it live.

**1. Launch the Studio**
While still in `frontend/`:

```bash
npm run dev

```

**2. Access the Interface**

* Open Browser: [http://localhost:3000/studio](https://www.google.com/search?q=http://localhost:3000/studio)
* Login (if asked) using your Sanity credentials.

**3. The Publishing Workflow**

1. Click **"Policy Analysis"** on the left menu.
2. Click your new article (it will be in the list).
3. **Check for Validation Errors (Red Icons):**
* **Audio:** If you don't have an MP3, delete the empty Audio block (trash can icon).
* **Video:** Ensure the URL is valid.
* **Date:** Ensure a date is selected.


4. **Hit "Publish"** (Green button at bottom right).

---

### Phase 4: The Frontend (User View)

**Goal:** Verify the article looks correct on the website.

**1. Access the Site**
The site runs on the same server you just started (`npm run dev`).

* **URL:** [http://localhost:3000](https://www.google.com/search?q=http://localhost:3000)

**2. Navigation**

* Click the **Menu** (Hamburger icon) or the **Pillar Dropdowns** (Policy, Economics, Tech).
* Find your article under the category you assigned (e.g., "Economics -> Value-Based Care").
* Click to read. Verify the **Data Table** renders correctly and the **Video** plays.

---

### Phase 5: The Chat Application (Backend)

**Goal:** Interact with your RAG (Retrieval-Augmented Generation) Chatbot.

**1. Setup (New Terminal)**
Open a **new** terminal window (keep the frontend running in the first one).

```bash
# 1. Go to project root
cd ~/Vermont-Health-Platform

# 2. Activate Python Virtual Environment
source backend/venv/bin/activate
# (You should see (venv) in your prompt)

# 3. Enter Backend Directory
cd backend

# 4. Start the Python App
python main.py

```

*(Note: If your entry file is named differently, use `python PITS_APP/main.py` or similar. Based on our history, `python main.py` is standard).*

**2. Access the Chat**

* **URL:** Typically [http://127.0.0.1:5000](https://www.google.com/url?sa=E&source=gmail&q=http://127.0.0.1:5000) (Check terminal output for exact port).

**3. The Workflow**

* **Upload:** Use the UI to upload PDFs (Policy documents, Reports).
* **Process:** Click "Process" to let the backend vectorize the text.
* **Chat:** Ask questions like *"Summarize the impact of inflation on rural hospitals"* to test against your own data.

---

### Summary Checklist

| Component | Key File Location | Command to Run | Local URL |
| --- | --- | --- | --- |
| **Prompt** | `frontend/sanity/prompt_template_v7.txt` | *Copy/Paste to AI* | N/A |
| **Import** | `frontend/scripts/import.js` | `node scripts/import.js <file>` | N/A |
| **Studio** | `frontend/sanity/schemaTypes/` | `npm run dev` | `/studio` |
| **Frontend** | `frontend/app/` | `npm run dev` | `localhost:3000` |
| **Backend** | `backend/PITS_APP/` | `source venv...` then `python main.py` | `localhost:5000` |